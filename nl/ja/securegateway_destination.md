---

copyright:
  years: 2015, 2017
lastupdated: "2017-04-10"

---

# 宛先の追加
{: #add-dest}

宛先は、特定のオンプレミス・リソースまたはクラウド・リソースに接続する方法を定義したものです。 宛先が作成されると、{{site.data.keyword.SecureGateway}} サーバーは固有のパブリック・エンドポイントをその宛先に提供し、ゲートウェイが接続されている間はそのエンドポイントで接続が listen されるようになります。

![宛先のないダッシュボード](./images/emptyDestinations.png?raw=true "宛先のないダッシュボード")

新規ゲートウェイ内の「宛先」タブで「宛先の追加」ボタンをクリックして、「宛先の追加」パネルを開きます。  宛先を作成する方法は 2 つあります。1 つはガイド付きセットアップで、各部分がアーキテクチャー全体にどのように収まるのかが示されます。もう 1 つは拡張セットアップで、すべてのフィールドとオプションが 1 つのパネルに示されます。  

ガイド付きセットアップでは、プロキシー情報の構成、サーバー・ネーム・インディケーター、および宛先固有の証明書/鍵ペアのアップロードは許可<b>されません</b>。  作成後、すべてのフィールドが「宛先の編集」パネルで使用可能です。

## ガイド付きセットアップ・パネル
{: #add-dest-guided-setup}

![ガイド付きセットアップ](./images/guidedLanding.png?raw=true "ガイド付きセットアップのランディング・パネル")

## 拡張セットアップ・パネル
{: #add-dest-advanced-setup}

![拡張セットアップ](./images/advancedLanding.png?raw=true "拡張セットアップのランディング・パネル")

## オンプレミス宛先とクラウド宛先
{: #dest-types}

宛先の作成時に最初に明確にする必要があるのは、接続する必要のあるリソースが存在する場所です。

### オンプレミスの宛先
{: #dest-types-on-prem}
オンプレミス宛先は、パブリック・スペース内のアプリケーションがオンプレミスにある制限付きリソースにアクセスする必要があるユース・ケース向けです。
![オンプレミス宛先](./images/onPremDestination.png?raw=true "オンプレミス宛先")

### クラウドの宛先
{: #dest-types-on-cloud}
クラウド宛先は、制限付きネットワークにあるアプリケーションがパブリック・スペース内のリソースにアクセスする必要があるユース・ケース向けです。
![リバース宛先](./images/reverseDestination.png?raw=true "クラウド宛先")

## 宛先の定義
{: #define-dest}
どちらのタイプの宛先でも、以下の情報が必要です。

- <b>リソース・ホスト名</b>: これは、接続する必要があるリソースの IP またはホスト名です。
- <b>リソース・ポート</b>: これは、リソースが listen を行うポートです。
- <b>プロトコル</b>: これは、アプリケーションが行う接続のタイプです。  さまざまな[プロトコル・オプション](#protocols-options)については、以下の表を参照してください。  リソースが予期している接続タイプの構成については、「[リソース認証](#dest-resource-auth)」セクションをチェックしてください。

クラウド宛先を選択した場合、<b>クライアント・ポート</b>も指定する必要があります。  これは、関連付けられたリソース・ホスト名およびリソース・ポートへの接続を許可するために {{site.data.keyword.SecureGateway}} クライアントが listen するポートです。

## プロトコル・オプション
{: #protocols-options}

次の表は、アプリケーションが {{site.data.keyword.SecureGateway}} との接続/要求を開始する方法について、使用可能なすべてのオプションを示します。

プロトコル | 説明
-- | --
TCP | 認証なし。 アプリケーションは、証明書をまったく必要とせずに {{site.data.keyword.SecureGateway}} サーバーと直接通信できます。
TLS: サーバー・サイド | Transport Layer Security (TLS) が有効化され、サーバーは自身の真正性を証明するために証明書を提示します。
TLS: 相互認証 | サーバーは証明書のセットを提示し、アプリケーションも接続の一環として証明書を提示する必要があります。
HTTP | オンプレミスのホスト名に一致するようにホスト・ヘッダーが書き換えられる TCP 接続。
HTTPS | オンプレミスのホスト名に一致するようにホスト・ヘッダーが書き換えられる TLS: サーバー・サイド接続。
HTTPS: 相互認証 | オンプレミスのホスト名に一致するようにホスト・ヘッダーが書き換えられる TLS: 相互認証接続。


## 相互認証の構成
{: #dest-mutual-auth}

相互認証を実施するプロトコルの場合、ユーザーが独自の証明書をアップロードする必要があるか、または、ユーザーのアプリケーションが使用できるようにサーバーが自己署名証明書/鍵ペアを自動的に作成します。  このペアは、サーバー証明書と一緒にダウンロードできます。
![相互認証のパネル](./images/mutualAuth.png?raw=true "相互認証のパネル")

### ユーザー認証
{: #dest-user-auth}

「ユーザー認証」セクションは、{{site.data.keyword.SecureGateway}} での要求/接続アプリケーションの権限を管理するためのものです。  このフィールドは、アプリケーションが任意の接続/要求と一緒に提示する証明書となる単一の証明書を受け入れます。

### リソース認証
{: #dest-resource-auth}

リソース認証は、{{site.data.keyword.SecureGateway}} が定義済みリソースへの接続をどのように試行するのかを決定します。  「なし」、「TLS」 (サーバー・サイド)、および「相互認証」の 3 つのオプションがあり、使用可能になる認証オプションは選択内容に応じて異なります。

リソースへの接続で TLS を有効にすることは、ユーザー認証に使用される TLS とは異なります。  ユーザー認証用の TLS は、初期要求側アプリケーションと {{site.data.keyword.SecureGateway}} の間 (例えば、{{site.data.keyword.Bluemix_notm}} アプリと {{site.data.keyword.SecureGateway}} サーバーの間) のアクセスをセキュアにします。一方、リソース認証用の TLS は、{{site.data.keyword.SecureGateway}} と定義済みリソースの間 (例えば、{{site.data.keyword.SecureGateway}} クライアントとオンプレミス・データベースの間) の接続をセキュアにします。

#### クラウド認証/オンプレミス認証
{: #cloud-or-on-prem-auth}

このオプションは、[「リソース認証」](#dest-resource-auth)に「TLS」または「相互認証」を選択すると使用可能になります。  フィールドの名前は、選択した[宛先タイプ](#dest-types)と一致します。  このフィールドでは、接続先のリソースの証明書を検証するために、最大 6 つの証明書をアップロードできます。  これらのファイルはリソースへの接続の CA に追加され、リソースが提示する証明書または証明書チェーンを含んでいる必要があります。

#### サーバー・ネーム・インディケーター (SNI)
{: #dest-sni}
このオプションは、[「リソース認証」](#dest-resource-auth)に「TLS」または「相互認証」を選択すると使用可能になります。  これは、リソース接続の TLS ハンドシェークに別のホスト名が提供されることを許可するために使用されます。

### クライアント証明書およびクライアント鍵
{: #dest-client-cert-key}
「クライアント証明書」フィールドおよび「クライアント鍵」フィールドが表示される場所は、選択した[宛先タイプ](#dest-types)によって異なります。  どちらの場合も、ここで提供されるファイルが SG クライアントによって、それ自体を TLS 接続用に識別するために使用されます。  ファイルがアップロードされない場合、{{site.data.keyword.SecureGateway}} サーバーは、CN を `localhost` に設定した自己署名ペアを自動的に生成します。  証明書/鍵ペアの生成方法については、[ここをクリック](/docs/services/SecureGateway?topic=securegateway-cert-key-management)してください。

オンプレミス宛先の場合、`「リソース認証: 相互認証」`が選択されていれば[「リソース認証」](#dest-resource-auth)の下に表示されます。  この場合、SG クライアントは、定義済みリソースへのアウトバウンド接続にこの証明書/鍵ペアを使用します。オンプレミス・リソースは、この証明書を自身の CA に追加して SG クライアントと通信する必要があります。

クラウド宛先の場合、TLS プロトコルが選択されていれば[「ユーザー認証」](#dest-user-auth)の下に表示されます。  この場合、SG クライアントは、この証明書/鍵ペアを使用して TLS リスナーを作成します。オンプレミス・アプリは、この証明書を自身の CA に追加して SG クライアントと通信する必要があります。

## ネットワーク・セキュリティーの構成
{: #dest-network-security}
特定の IP アドレス以外のすべての IP アドレスがクラウドのホストおよびポートに接続するのを防止するために、オンプレミス宛先に IP テーブル・ルールを適用することを選択できます。
![「ネットワーク・セキュリティー」パネル](./images/networkSecurity.png?raw=true "「ネットワーク・セキュリティー」パネル")

IP テーブル・ルールを適用するには、「ネットワーク・セキュリティー」パネルで<b>「IP テーブル・ルールを使用して、この宛先へのクラウド・アクセスを制限します」</b>ボックスにチェック・マークを付けます。  このボックスにチェック・マークを付けると、接続が許可される IP の追加を開始できます。  IP が何も指定されない場合、<b>「クラウド・アクセスを制限します」</b>ボックスにチェック・マークが付いている限り、このクラウドのホストおよびポートへのすべての接続が拒否されます。

<b>注:</b> 指定される IP またはポートは、要求を行うマシンのローカル IP アドレスではなく、{{site.data.keyword.SecureGateway}} サーバーからアクセスできる外部 IP アドレスでなければなりません。

### IP テーブル・ルールの追加
{: #dest-iptables}
IP テーブルにルールを追加するときには、個々の IP または IP 範囲を、単一ポートまたはポート範囲のいずれかと共に指定できます。  指定された範囲はすべて包括的です。  次の表に、いくつかの例と、それらが IP テーブル内でどのように解決されるかを示します。

IP アドレス | ポート | 結果
-- | -- | --
1.2.3.4 | 5000 | ポート 5000 からの IP 1.2.3.4 のみが許可されます。
1.2.3.4-2.3.4.5 | 5000 | ポート 5000 からの 1.2.3.4 から 2.3.4.5 までのすべての IP が許可されます。
1.2.3.4 | 5000:10000 | 5000 から 10000 までのポートからの IP 1.2.3.4 のみが許可されます。
1.2.3.4-2.3.4.5 | 5000:10000 | 5000 から 10000 までのポートからの 1.2.3.4 から 2.3.4.5 までのすべての IP が許可されます。
1.2.3.4 | | 任意のポートからの IP 1.2.3.4 のみが許可されます。
| 5000 | ポート 5000 からの任意の IP が許可されます。

特定のルールをアプリケーションに関連付けることもできます。  関連ルールの作成について詳しくは、[アプリ用の IP テーブル・ルールの作成方法](/docs/services/SecureGateway?topic=securegateway-iptables-rules)を参照してください。

## プロキシー・オプションの構成
{: #dest-proxy}
オンプレミスの宛先が SOCKS プロキシーの背後にある場合、「プロキシー・オプション」パネルで宛先のプロキシー設定を構成できます。
![「プロキシー・オプション」パネル](./images/proxyOptions.png?raw=true "「プロキシー・オプション」パネル")

プロキシー設定を構成するには、プロキシーが listen を行うホスト名およびポートと、使用される SOCKS プロトコルを指定するだけで済みます (4、4a、5)。

## 宛先の設定
{: #dest-settings}
宛先が作成された後、設定アイコンをクリックすると以下の情報が表示されます。

- API を使用するために必要な宛先 ID。
- <b>オンプレミス宛先には、クラウド・ホストとポートが含まれます。  この情報は、オンプレミス・リソースに接続するためにアプリケーションによって必要とされます。</b>
- <b>クラウド宛先には、クライアント・ポートが含まれます。  これは、オンプレミス・アプリケーションをクラウド・リソースに接続するために {{site.data.keyword.SecureGateway}} クライアントが listen するポートです。</b>
- この宛先が指すリソースのホストおよびポート。
- 宛先が作成された日時および作成したユーザー。
- 宛先の最終変更日時および変更したユーザー。
